{"version":3,"sources":["webpack:///./src/utils/querystring.js","webpack:///./src/pages/authorize/github.jsx"],"names":["parse","search","qs","replace","split","data","connect","state","me","global","dispatch","updateMe","React","useState","undefined","success","setSuccess","useEffect","isBrowser","querystring","window","location","code","fetch","process","method","headers","body","JSON","stringify","then","res","ok","json","Error","statusText","user","path","navigate","catch","e","console","error","css","title","description","to","width","name","login","onClick","reload"],"mappings":"miCAAO,IAAMA,EAAQ,SAACC,GAKlB,IADA,IACA,EADMC,EAAK,GACX,IAHAD,GADAA,EAASA,EAAOE,QAAQ,MAAO,KACfC,MAAM,QAGtB,aAA0B,CAAC,IACnBC,EADkB,QACLD,MAAM,KACvBF,EAAGG,EAAK,IAAMA,EAAK,GAGvB,OAAOH,I,kgBCoFII,uBACX,SAAAC,GAAK,MAAK,CAAEC,GAAID,EAAME,OAAOD,OAC7B,SAAAE,GAAQ,MAAK,CAAEC,SAAU,SAACH,GAAD,OAAQE,EAASC,YAASH,QAFxCF,EAnFQ,SAAC,GAAsB,IAApBE,EAAmB,EAAnBA,GAAIG,EAAe,EAAfA,SAAe,EACTC,IAAMC,cAASC,GAAvCC,EADiC,KACxBC,EADwB,KA2CzC,OAxCAJ,IAAMK,WAAU,WACZ,GAAKC,cAAL,CAEA,IAAMhB,EAAKiB,IAAkBC,OAAOC,SAASpB,QAEzCC,EAAGoB,KACHF,OAAOG,MAAMC,4CAAuC,CAChDC,OAAQ,OACRC,QAAS,CACL,OAAU,mBACV,eAAgB,oBAEpBC,KAAMC,KAAKC,UAAU,CACjBP,KAAMpB,EAAGoB,SAEdQ,MAAK,SAAAC,GACJ,GAAIA,EAAIC,GAAI,OAAOD,EAAIE,OACvB,MAAM,IAAIC,MAAMH,EAAII,eACrBL,MAAK,SAAAM,GACJpB,GAAW,GACXL,EAASyB,GAELlC,EAAGmC,KACHC,YAASpC,EAAGmC,MAEZC,YAAS,eAEdC,OAAM,SAACC,GACNC,QAAQC,MAAMF,GACdxB,GAAW,MAGXd,EAAGmC,KACHC,YAAS,mBAAqBpC,EAAGmC,MAEjCC,YAAS,iBAGlB,CAAE3B,IAGD,mBAAKgC,IAAG,GAGJ,YAAC,IAAD,CACIC,MAAM,uBACNC,YAAY,kDAEhB,YAAC,IAAD,CACIC,GAAG,IACHH,IAAG,GASH,YAAC,IAAD,CAAMI,MAAM,UAEhB,mBAAKJ,IAAG,GAIJ,YAAC,IAAD,CAAUA,IAAG,IACb,wBAEoB,IAAZ5B,EACI,yCAAsBP,EAAKA,EAAGwC,MAAQxC,EAAGyC,MAAQ,GAAjD,iBACY,IAAZlC,EACI,yCAAoB,oBAAM4B,IAAG,EAAyBO,QAAU,kBAAMhC,cAAcE,OAAOC,SAAS8B,SAAW,KAA3F,eACpB","file":"component---src-pages-authorize-github-jsx-6270b4fdfa3beb83a97e.js","sourcesContent":["export const parse = (search) => {\n    search = search.replace(/^\\?/, \"\");\n    search = search.split(\"&\");\n\n    const qs = {};\n    for (let field of search) {\n        let data = field.split(\"=\");\n        qs[data[0]] = data[1];\n    }\n\n    return qs;\n};\n","import React from \"react\";\nimport { connect } from \"react-redux\";\nimport { Link, navigate } from \"gatsby\";\nimport { FiGithub } from \"react-icons/fi\";\n\nimport Helmet from \"../../components/Helmet\";\nimport Logo from \"../../components/Logo\";\nimport { updateMe } from \"../../state/global\";\nimport isBrowser from \"../../utils/isBrowser\";\nimport * as querystring from \"../../utils/querystring\";\n\nconst GitHubAuthPage = ({ me, updateMe }) => {\n    const [ success, setSuccess ] = React.useState(undefined);\n\n    React.useEffect(() => {\n        if (!isBrowser()) return;\n\n        const qs = querystring.parse(window.location.search);\n\n        if (qs.code) {\n            window.fetch(process.env.API_URL + \"/login/github\", {\n                method: \"POST\",\n                headers: {\n                    \"Accept\": \"application/json\",\n                    \"Content-Type\": \"application/json\",\n                },\n                body: JSON.stringify({\n                    code: qs.code,\n                }),\n            }).then(res => {\n                if (res.ok) return res.json();\n                throw new Error(res.statusText);\n            }).then(user => {\n                setSuccess(true);\n                updateMe(user);\n\n                if (qs.path) {\n                    navigate(qs.path);\n                } else {\n                    navigate(\"/account\");\n                }\n            }).catch((e) => {\n                console.error(e);\n                setSuccess(false);\n            });\n        } else {\n            if (qs.path) {\n                navigate(\"/authorize?path=\" + qs.path);\n            } else {\n                navigate(\"/authorize\");\n            }\n        }\n    }, [ updateMe ]);\n\n    return (\n        <div css={{\n            textAlign: \"center\",\n        }}>\n            <Helmet\n                title=\"Authorize via GitHub\"\n                description=\"Login to Glee, via GitHub, to start using it.\"\n            />\n            <Link\n                to=\"/\"\n                css={{\n                    height: 42,\n                    marginBottom: 25,\n                    display: \"flex\",\n                    alignItems: \"center\",\n                    justifyContent: \"center\",\n                    width: \"100%\",\n                }}\n            >\n                <Logo width=\"100%\" />\n            </Link>\n            <div css={{\n                display: \"flex\",\n                alignItems: \"center\",\n            }}>\n                <FiGithub css={{ marginRight: 10 }} />\n                <div>\n                    {\n                        success === true\n                        ?   <span>Authenticated { me ? me.name || me.login : \"\" } with GitHub</span>\n                        :   success === false\n                            ?   <span>Unauthorized. <span css={{ cursor: \"pointer\" }} onClick={ () => isBrowser() ? window.location.reload() : {} }>Try again?</span></span>\n                            :   <span>Authenticating with GitHub...</span>\n                    }\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default connect(\n    state => ({ me: state.global.me }),\n    dispatch => ({ updateMe: (me) => dispatch(updateMe(me)) }),\n)(GitHubAuthPage);\n"],"sourceRoot":""}